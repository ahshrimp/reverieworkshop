var rpsFunc={};var rpsOpt={};rpsOpt.blogRoot='';var rpsDisp={};var rps$={};var rpsLabels={};var rpsBlog={};var rpsFeeds={};rpsFeeds.PostsNum=0;rpsFeeds.maxRank=1;rpsFeeds.Ranks=[];rpsFeeds.Titles=[];rpsFeeds.Urls=[];rpsFeeds.Dates=[];rpsFeeds.idx=[];rpsFeeds.idxNum=0;rpsFunc.page=function(a){rpsFeeds.Next=rpsFeeds.Lines*(a-1);rpsFunc.redrawBoard()};rpsFunc.redrawBoard=function(){var r=0;var i=0;var j;var g=0;var h='';var k;var l=0;var m=[{P:100,R:208,G:0,B:0},{P:50,R:255,G:204,B:0},{P:0,R:0,G:64,B:128}];var n='';var o='';var p='';var q=0;var s=10;var t,pThis;function spanRGB(a,b){var c,myG,myB;for(var i=0;i<b.length;i++){if(a>=b[i].P){if(i==0){c=b[i].R;myG=b[i].G;myB=b[i].B}else{var d=a-b[i].P;var e=b[i-1].P-a;var f=b[i-1].P-b[i].P;c=Math.floor((b[i-1].R*d+b[i].R*e)/f);myG=Math.floor((b[i-1].G*d+b[i].G*e)/f);myB=Math.floor((b[i-1].B*d+b[i].B*e)/f)}return('<font style="color: rgb('+c+','+myG+','+myB+');">');break}}return('<font>')};function DispReplace(a){var b=a;do{a0=b;b=b.replace(/%PostTitle%/gi,'<a href="'+rpsFeeds.Urls[r]+'">'+rpsFeeds.Titles[r]+'</a>');b=b.replace(/%PostDate%/gi,rpsFeeds.Dates[r]);b=b.replace(/%PostRankPure%/gi,l+'');b=b.replace(/%PostRank%/gi,o);b=b.replace(/%PostNum%/gi,rpsFeeds.idxNum+'');b=b.replace(/%PostNumFrom%/gi,(q+1)+'');b=b.replace(/%PostNumTo%/gi,s+'')}while(a0!=b);return b}if(rpsFeeds.Titles.length>0){rpsFeeds.This=rpsFeeds.Next;if(!(rpsFeeds.Lines>0)){rpsFeeds.Lines=10}if(rpsFeeds.This<0){rpsFeeds.This=0}if(rpsFeeds.This>=rpsFeeds.idxNum){rpsFeeds.This=rpsFeeds.idxNum-1}t=Math.ceil(rpsFeeds.idxNum/rpsFeeds.Lines);pThis=Math.floor(rpsFeeds.This/rpsFeeds.Lines)+1;q=(pThis-1)*rpsFeeds.Lines;s=Math.min(q+rpsFeeds.Lines,rpsFeeds.idxNum);n=DispReplace(rpsDisp.ListHead);rps$.Board.find('#headmsg').text('').append(n);rps$.Board.find('#progress').text('');rps$.mainList.html('<ul>');for(j=q;j<rpsFeeds.idxNum&&j<s;j++){r=rpsFeeds.idx[j];l=Math.floor(100*rpsFeeds.Ranks[r]/rpsLabels.loadLabelNum);k=spanRGB(l,m);o=DispReplace(k+rpsDisp.Rank+'</font>');p=DispReplace(rpsDisp.ListLine);rps$.mainList.append('<li>'+p+'</li>')}rps$.mainList.append('</ul>');var u=rps$.Board.find('#navi');var v;u.html('');v='<img src="http://sites.google.com/site/matthewhkh/file/page_previous.png" border="0" alt="上一頁">';if(pThis>1){v='<a id="prev" href="javascript:rpsFunc.page('+(pThis-1)+');">'+v+'</a>'}v=v+' / ';u.append(v);v='<img src="http://sites.google.com/site/matthewhkh/file/page_next.png" border="0" alt="下一頁">';if(pThis<t){v='<a id="prev" href="javascript:rpsFunc.page('+(pThis+1)+');">'+v+'</a>'}v=v+' / ';u.append(v);for(i=1;i<=t;i++){u.append(' ');v='&lt;'+i+'&gt;';if(i!=pThis){v='<a id="prev" href="javascript:rpsFunc.page('+i+');">'+v+'</a>'}else{v='<b>'+v+'</b>'}u.append(v)}}};rpsFunc.readOK=function(){var a=Math.floor(90*rpsLabels.loadLabelNum/rpsLabels.postLabelNum);rps$.Board.find('#progress').text('( '+a+'% )');if(rpsLabels.loadLabelNum==rpsLabels.postLabelNum){rps$.Board.find('#headmsg').text('');rps$.Board.find('#progress').text('');SortRelatedPosts();rpsFeeds.Lines=rpsOpt.Lines;rpsFeeds.This=0;rpsFeeds.Next=0;rpsFunc.redrawBoard()}};rpsFunc.readFeed=function(a){var b=/</g,regex2=/>/g;var i,j;var c="";rpsLabels.loadLabelNum+=1;for(i=0;i<a.feed.entry.length;i++){var d=a.feed.entry[i];c="";for(j=0;j<d.link.length;j++){if(d.link[j].rel=='alternate'){c=d.link[j].href;break}}if(c!=""){for(j=0;j<=rpsFeeds.PostsNum;j++){if(rpsFeeds.Urls[j]==c){rpsFeeds.Ranks[j]++;if(rpsFeeds.Ranks[j]>rpsFeeds.maxRank){rpsFeeds.maxRank=rpsFeeds.Ranks[j]}c="";break}}}if(c!=""){rpsFeeds.Titles[rpsFeeds.PostsNum]=(d.title.$t.replace(b,'&lt;')).replace(regex2,'&gt;');rpsFeeds.Dates[rpsFeeds.PostsNum]=d.published.$t.substr(0,10);rpsFeeds.Urls[rpsFeeds.PostsNum]=c;rpsFeeds.Ranks[rpsFeeds.PostsNum]=1;rpsFeeds.PostsNum++}}rpsFunc.readOK()};function SortRelatedPosts(){for(var j=rpsFeeds.maxRank;j>0;j--){for(var i=0;i<rpsFeeds.Urls.length;i++){if(rpsBlog.postUrl!=rpsFeeds.Urls[i]){if(rpsFeeds.Ranks[i]==j){rpsFeeds.idx[rpsFeeds.idxNum]=i;rpsFeeds.idxNum++}}}}}rpsFunc.fatchLabel=function(){var a=jQuery(rpsOpt.LocateLabels[0]);var b;var c=document.getElementsByTagName('head')[0];var i,l,s1,s2,p1,feedUrl;if(rpsOpt.LocateLabels[rpsOpt.LocateLabels.length-1]!='a'){rpsOpt.LocateLabels[rpsOpt.LocateLabels.length]='a'}for(i=1;i<rpsOpt.LocateLabels.length;i++){if(a.length>0){a=a.find(rpsOpt.LocateLabels[i])}}if(a.length==0){a=jQuery('.post-footer').find('.post-labels').find('a')}rpsLabels.postLabelNum=a.length;rpsLabels.loadLabelNum=0;l=rpsOpt.blogRoot.length;while(l>0){if(rpsOpt.blogRoot.charAt(l-1)=='/'){rpsOpt.blogRoot=rpsOpt.blogRoot.slice(0,l-1);l=rpsOpt.blogRoot.length}else{l=0}}for(i=0;i<rpsLabels.postLabelNum;i++){s1=a.eq(i).attr('href');p1=s1.search(rpsOpt.urlSearchLabel);if(p1>0){s2=s1.slice(p1+rpsOpt.urlSearchLabel.length);if(rpsOpt.blogRoot.length==0){rpsOpt.blogRoot=s1.slice(0,p1)}s1=a.eq(i).text();var d=s2.search(/\?/);if(d>0){s2=s2.slice(0,d)}feedUrl=rpsOpt.blogRoot+rpsOpt.feedSearchLabel+s2+'?max-results=20&alt=json-in-script&callback=rpsFunc.readFeed';b=document.createElement('script');b.src=feedUrl;b.type='text/javascript';c.appendChild(b)}}};rpsFunc.ToggleMsg=function(a){var b,toDisp,i;if(a.length==1){b=a.get(0);if(b.style.display=='inline'){b.style.display='none'}else{b.style.display='inline'}}else{toDisp='inline';for(i=0;i<a.length;i++){if(a.get(i).style.display=='inline'){toDisp='none';break}}for(i=0;i<a.length;i++){a.get(i).style.display=toDisp}}};rpsFunc.initVar=function(){var a;rpsBlog.postUrl=document.URL;a=rpsBlog.postUrl.search(/\?/);if(a>0){rpsBlog.postUrl=rpsBlog.postUrl.slice(0,a)}rpsFeeds.Urls[0]=rpsBlog.postUrl;rpsFeeds.PostsNum=1};rpsFunc.initBoard=function(){var a=jQuery('body');var b=rpsOpt.LocateBoard[0].match(/append|prepend|before|after/i);var c=0;var d=1;var e=0;rps$.Board='';if(typeof(b)=='object'){b=b[0]}if(b.length>0){c=1}else{c=0;b=''}for(var i=c;i<rpsOpt.LocateBoard.length;i++){if(a.length>0){switch(typeof(rpsOpt.LocateBoard[i])){case'string':a=a.find(rpsOpt.LocateBoard[i]);break;case'number':if(e==0){e=rpsOpt.LocateBoard[i]}e=Math.min(e,rpsOpt.LocateBoard[i]);d=Math.max(d,rpsOpt.LocateBoard[i]);break;default:}}}if(a.length==0){return}if((a.length<e)||(a.length>d)){return}var f='<br/><div id="rpsBoard"></div>';switch(b.toLowerCase()){case'prepend':a.prepend(f);break;case'after':a.after(f);break;case'before':a.before(f);break;default:a.append(f)}rps$.Board=jQuery('#rpsBoard');rps$.Board.append('<div><p><span id="headmsg">'+rpsDisp.Loading+'</span>'+'<span id="progress"> ( 0% ) </span></p></div>'+'<p id="navi"></p>'+'<div id="mainList"></div>');rps$.mainList=rps$.Board.find('#mainList');rps$.Board.append('<br />')};rpsFunc.main01=function(){jQuery(document).ready(function(){rpsFunc.initVar();rpsFunc.initBoard();if(!rps$.Board)return;rpsFunc.fatchLabel()})};rpsDisp.Rank='(%PostRankPure%%)';rpsDisp.Loading='相關文章載入中 ...';rpsDisp.ListHead='約有 %PostNum% 篇相關文章，以下是第 %PostNumFrom% 至 %PostNumTo% 篇';rpsDisp.ListLine='<div class="related_post">%PostRank% %PostTitle% - %PostDate%</div>';rpsOpt.urlSearchLabel='/search/label/';rpsOpt.feedSearchLabel='/feeds/posts/summary/-/';rpsOpt.LocateLabels=['.post-footer','.post-labels','a'];rpsOpt.LocateBoard=['append','.post-footer'];rpsOpt.Lines=10;rpsFunc.main01();